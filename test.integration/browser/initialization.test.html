<html>

<head>
    <meta charset="utf-8">
    <title>Initialization test</title>
    <link href="./../../node_modules/mocha/mocha.css" rel="stylesheet" />
</head>

<body>
    <div id="mocha"></div>
    <script src="./../../node_modules/mocha/mocha.js"></script>
    <script src="./../../node_modules/dcorejs-lib/dist/bundle.js" type="text/javascript"></script>
    <script src="./../../dist/dcorejs.umd.js" type="text/javascript"></script>
    <script src="./../../node_modules/chai/chai.js" type="text/javascript"></script>
    <script>
        mocha.setup('bdd')
    </script>
    <!--<script src="init.js" type="application/javascript"></script>-->
    <script>
        const dcorejs_lib = window['dcorejs-lib'];
        const dcore_js = window['dcorejs'];
        const chai = window['chai'];

        const chainId = '17401602b201b3c45a3ad98afc6fb458f91f519bd30d1058adf6f2bed66376bc';
        const dcoreNetworkAddresses = ['wss://stage.decentgo.com:8090'];
        // turn off unverified certificate rejection
        // process.env['NODE_TLS_REJECT_UNAUTHORIZED'] = '0';

        function initialize(callback) {
            dcore_js.initialize({
                    chainId: chainId,
                    dcoreNetworkWSPaths: dcoreNetworkAddresses
                }, dcorejs_lib, callback);
        }

        describe('Initialize lib ', () => {
            it('conection handle callback response', (done) => {
                function connectionHandler(state) {
                    console.log(state);
                    chai.should().exist(state);
                    done();
                }
                dcore_js.initialize({
                    chainId: chainId,
                    dcoreNetworkWSPaths: dcoreNetworkAddresses
                }, dcorejs_lib, callback);
            });

            it('successfully connect', (done) => {
                function connectionHandler(state) {
                    console.log(state);
                    chai.expect(state).to.equal('open');
                    done();
                }
                dcore_js.initialize({
                    chainId: chainId,
                    dcoreNetworkWSPaths: dcoreNetworkAddresses
                }, dcorejs_lib, connectionHandler);
            });
        });

        // mocha.run();
    </script>

    <script>
        mocha.run()
    </script>
</body>

</html>